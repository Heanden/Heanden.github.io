# <center>实验二 	超声波测距数据处理实验</center>
## 一、硬件参数
​        由于超声波指向性强，能量消耗缓慢，在介质中传播的距离较远，因而超声波经常用于距离的测量，如测距仪和物位测量仪等都可以通过超声波来实现。利用超声波检测往往比较迅速、方便、计算简单、易于做到实时控制，并且在测量精度方面能达到工业实用的要求，因此在移动机器人研制上也得到了广泛的应用。压电式超声波发生器原理。
​        本实验采用的传感器是压电式超声波发生器，实际上是利用压电晶体的谐振来工作的。它有两个压电晶片和一个共振板。当它的两极外加脉冲信号，其频率等于压电晶片的固有振荡频率时，压电晶片将会发生共振，并带动共振板振动，便产生超声波。反之，如果两电极间未外加电压，当共振板接收到超声波时，将压迫压电晶片作振动，将机械能转换为电信号，这时它就成为超声波接收器了。
​        超声波测距原理：超声波发射器向某一方向发射超声波，在发射时刻的同时开始计时，超声波在空气中传播，途中碰到障碍物就立即返回来，超声波接收器收到反射波就立即停止计时。超声波在空气中的传播速度为340m/s，根据计时器记录的时间t，就可以计算出发射点距障碍物的距离(s)，即：s=340t/2 。这就是所谓的时间差测距法。

## 二、实验原理
​         本实验用NE555电路产生40KHZ的脉冲信号用来发送超声波，此信号出厂已调节，请使用时再测量和微调。接收头接收到信号后，进行了放大，滤波，整形等处理环节，可输出下降沿或者上升沿等接收信号。单片机使用1个IO口控制发射，外部中断脚接收，定时器0来计时。从而可得到从发射到接收的时间来计算障碍物的距离。附带的还有温度的采集和显示，蜂鸣器提示音，但未对超声波测距做温度补偿。

## 三、实验内容
1. 改变被测物体与超声波探头的距离，以卷尺测量结果作为X值，超声波测距结果作为Y值，建议每1cm读一个数，从3cm增加到60cm左右为止。将读数填入下表。
2. 改变被测物体与超声波探头的距离，以卷尺测量结果作为X值，超声波测距结果作为Y值，建议每1cm读一个数，从60cm减小到3cm左右为止。将读数填入下表。
3. 根据表1表2，画出X－Y曲线。
4. 分别计算两条曲线的端点线性度和最小二乘线性度，并根据两条曲线数据计算迟滞误差。
5. 重复步骤1和步骤2各三次，列表记录数据，并据此计算重复性误差。
6. 用Matlab画出每次测量的实测曲线和拟合直线。

| t(cm) | a1(cm) | b1(cm) | a2(cm) | b2(cm) | a3(cm) | b3(cm) |
| :---: | :----: | :----: | :----: | :----: | :----: | :----: |
|  3.0  |  7.2   |  10.5  |  10.4  |  9.0   |  9.1   |  6.2   |
|  4.0  |  6.4   |  7.5   |  13.5  |  10.2  |  8.8   |  5.8   |
|  5.0  |  12.9  |  10.6  |  9.5   |  10.9  |  13.6  |  6.9   |
|  6.0  |  12.7  |  14.5  |  13.2  |  7.6   |  8.6   |  12.6  |
|  7.0  |  12.4  |  11.2  |  12.1  |  15.8  |  9.0   |  13.8  |
|  8.0  |  14.7  |  16.9  |  15.4  |  13.6  |  13.3  |  12.1  |
|  9.0  |  12.8  |  16.7  |  15.9  |  13.8  |  14.5  |  13.0  |
| 10.0  |  10.1  |  20.2  |  12.5  |  15.5  |  15.2  |  17.7  |
| 11.0  |  14.5  |  19.2  |  15.9  |  15.3  |  20.1  |  12.6  |
| 12.0  |  14.4  |  22.4  |  15.3  |  18.6  |  19.5  |  19.4  |
| 13.0  |  13.1  |  21.0  |  22.2  |  13.7  |  18.5  |  19.3  |
| 14.0  |  20.5  |  26.3  |  18.1  |  13.8  |  22.6  |  15.6  |
| 15.0  |  22.4  |  19.8  |  19.5  |  20.4  |  21.1  |  20.7  |
| 16.0  |  21.9  |  25.1  |  23.2  |  21.8  |  23.8  |  20.7  |
| 17.0  |  19.9  |  26.4  |  25.0  |  20.9  |  21.7  |  24.7  |
| 18.0  |  27.0  |  25.5  |  24.0  |  22.0  |  21.3  |  22.3  |
| 19.0  |  26.3  |  28.1  |  24.5  |  37.8  |  29.9  |  25.0  |
| 20.0  |  26.1  |  27.3  |  24.7  |  29.7  |  28.0  |  26.4  |
| 21.0  |  31.2  |  31.1  |  25.9  |  28.8  |  30.4  |  22.8  |
| 22.0  |  28.8  |  26.6  |  27.9  |  29.2  |  34.0  |  34.6  |
| 23.0  |  29.6  |  31.7  |  26.2  |  28.5  |  30.9  |  39.4  |
| 24.0  |  27.2  |  35.3  |  34.6  |  26.7  |  30.6  |  41.3  |
| 25.0  |  29.6  |  38.2  |  32.4  |  34.8  |  33.6  |  37.4  |
| 26.0  |  31.6  |  35.9  |  36.2  |  31.2  |  33.7  |  41.4  |
| 27.0  |  34.3  |  36.6  |  36.6  |  34.0  |  34.3  |  41.1  |
| 28.0  |  35.4  |  36.7  |  37.9  |  32.5  |  35.6  |  42.5  |
| 29.0  |  33.9  |  37.3  |  36.2  |  36.3  |  34.5  |  42.4  |
| 30.0  |  38.7  |  38.2  |  38.4  |  38.7  |  36.8  |  40.6  |
| 31.0  |  36.2  |  40.3  |  42.5  |  35.3  |  40.6  |  44.2  |
| 32.0  |  40.0  |  44.4  |  43.6  |  36.9  |  42.5  |  49.2  |
| 33.0  |  42.3  |  44.3  |  37.2  |  37.3  |  43.7  |  51.8  |
| 34.0  |  40.1  |  45.6  |  42.8  |  41.5  |  45.1  |  46.9  |
| 35.0  |  42.7  |  48.0  |  42.6  |  44.6  |  50.1  |  48.4  |
| 36.0  |  44.8  |  47.0  |  42.6  |  48.0  |  45.5  |  55.1  |
| 37.0  |  44.6  |  47.8  |  46.4  |  45.6  |  47.3  |  54.3  |
| 38.0  |  45.1  |  50.5  |  46.1  |  45.3  |  46.1  |  51.0  |
| 39.0  |  49.5  |  50.1  |  46.5  |  48.0  |  46.2  |  51.6  |
| 40.0  |  53.4  |  53.7  |  52.2  |  45.9  |  50.8  |  56.5  |
| 41.0  |  50.4  |  52.7  |  49.9  |  48.8  |  48.2  |  56.4  |
| 42.0  |  55.5  |  51.8  |  48.2  |  45.2  |  52.9  |  59.1  |
| 43.0  |  50.7  |  54.6  |  55.9  |  51.0  |  56.4  |  58.6  |
| 44.0  |  55.7  |  60.3  |  55.9  |  53.1  |  55.0  |  62.0  |
| 45.0  |  59.3  |  60.0  |  55.7  |  53.0  |  54.5  |  60.2  |
| 46.0  |  59.2  |  61.6  |  54.5  |  52.4  |  59.2  |  60.3  |
| 47.0  |  64.5  |  60.4  |  58.6  |  57.5  |  57.9  |  63.8  |
| 48.0  |  58.4  |  59.4  |  54.2  |  60.3  |  57.0  |  63.8  |
| 49.0  |  58.3  |  65.9  |  58.4  |  61.1  |  60.6  |  62.2  |
| 50.0  |  59.2  |  59.3  |  61.4  |  59.3  |  61.9  |  61.3  |
| 51.0  |  61.6  |  65.4  |  62.1  |  58.6  |  60.4  |  65.2  |
| 52.0  |  61.9  |  65.4  |  64.6  |  57.1  |  64.8  |  67.1  |
| 53.0  |  66.6  |  68.5  |  61.8  |  63.4  |  65.7  |  66.1  |
| 54.0  |  67.1  |  65.9  |  65.5  |  65.7  |  65.2  |  68.9  |
| 55.0  |  67.2  |  66.7  |  69.7  |  64.8  |  66.7  |  72.6  |
| 56.0  |  69.8  |  70.6  |  69.6  |  67.7  |  68.8  |  73.0  |
| 57.0  |  68.3  |  70.1  |  68.9  |  67.9  |  70.7  |  71.5  |
| 58.0  |  66.7  |  73.2  |  66.9  |  75.8  |  64.9  |  72.9  |
| 59.0  |  73.4  |  78.0  |  67.0  |  72.3  |  71.8  |  71.4  |
| 60.0  |  73.0  |  76.7  |  72.9  |  72.4  |  71.5  |  71.8  |

## 四、程序及结果

#### 0. 数据输入

```matlab
num=[
7.2 6.4 12.9 12.7 12.4 14.7 12.8 10.1 14.5 14.4 13.1 20.5 22.4 21.9 19.9 27.0 26.3 26.1 31.2 28.8 29.6 27.2 29.6 31.6 34.3 35.4 33.9 38.7 36.2 40.0 42.3 40.1 42.7 44.8 44.6 45.1 49.5 53.4 50.4 55.5 50.7 55.7 59.3 59.2 64.5 58.4 58.3 59.2 61.6 61.9 66.6 67.1 67.2 69.8 68.3 66.7 73.4 73.0;
10.5 7.5 10.6 14.5 11.2 16.9 16.7 20.2 19.2 22.4 21.0 26.3 19.8 25.1 26.4 25.5 28.1 27.3 31.1 26.6 31.7 35.3 38.2 35.9 36.6 36.7 37.3 38.2 40.3 44.4 44.3 45.6 48.0 47.0 47.8 50.5 50.1 53.7 52.7 51.8 54.6 60.3 60.0 61.6 60.4 59.4 65.9 59.3 65.4 65.4 68.5 65.9 66.7 70.6 70.1 73.2 78.0 76.7;
10.4 13.5 9.5 13.2 12.1 15.4 15.9 12.5 15.9 15.3 22.2 18.1 19.5 23.2 25.0 24.0 24.5 24.7 25.9 27.9 26.2 34.6 32.4 36.2 36.6 37.9 36.2 38.4 42.5 43.6 37.2 42.8 42.6 42.6 46.4 46.1 46.5 52.2 49.9 48.2 55.9 55.9 55.7 54.5 58.6 54.2 58.4 61.4 62.1 64.6 61.8 65.5 69.7 69.6 68.9 66.9 67.0 72.9;
9.0 10.2 10.9 7.6 15.8 13.6 13.8 15.5 15.3 18.6 13.7 13.8 20.4 21.8 20.9 22.0 37.8 29.7 28.8 29.2 28.5 26.7 34.8 31.2 34.0 32.5 36.3 38.7 35.3 36.9 37.3 41.5 44.6 48.0 45.6 45.3 48.0 45.9 48.8 45.2 51.0 53.1 53.0 52.4 57.5 60.3 61.1 59.3 58.6 57.1 63.4 65.7 64.8 67.7 67.9 75.8 72.3 72.4;
9.1 8.8 13.6 8.6 9.0 13.3 14.5 15.2 20.1 19.5 18.5 22.6 21.1 23.8 21.7 21.3 29.9 28.0 30.4 34.0 30.9 30.6 33.6 33.7 34.3 35.6 34.5 36.8 40.6 42.5 43.7 45.1 50.1 45.5 47.3 46.1 46.2 50.8 48.2 52.9 56.4 55.0 54.5 59.2 57.9 57.0 60.6 61.9 60.4 64.8 65.7 65.2 66.7 68.8 70.7 64.9 71.8 71.5;
6.2 5.8 6.9 12.6 13.8 12.1 13.0 17.7 12.6 19.4 19.3 15.6 20.7 20.7 24.7 22.3 25.0 26.4 22.8 34.6 39.4 41.3 37.4 41.4 41.1 42.5 42.4 40.6 44.2 49.2 51.8 46.9 48.4 55.1 54.3 51.0 51.6 56.5 56.4 59.1 58.6 62.0 60.2 60.3 63.8 63.8 62.2 61.3 65.2 67.1 66.1 68.9 72.6 73.0 71.5 72.9 71.4 71.8;
];
t=3:1:60;
a1=num(1,:);a2=num(3,:);a3=num(5,:);%正着测的数据
b1=num(2,:);b2=num(4,:);b3=num(6,:);%反着测的数据
```

#### 1.  端点线性度

```matlab
y=a1;p=polyfit([t(1),t(58)],[y(1),y(58)],1);PP=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
ra1=100*max(abs(polyval(p,t)-y))/max(y);
subplot(231);plot(t,y,'-',ti,yi,'--');
legend('原始数据','端点线性度');title('a1');
y=a2;p=polyfit([t(1),t(58)],[y(1),y(58)],1);PP=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
ra2=100*max(abs(polyval(p,t)-y))/max(y);
subplot(232);plot(t,y,'-',ti,yi,'--');
legend('原始数据','端点线性度');title('a2');
y=a3;p=polyfit([t(1),t(58)],[y(1),y(58)],1);PP=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
ra3=100*max(abs(polyval(p,t)-y))/max(y);
subplot(233);plot(t,y,'-',ti,yi,'--');
legend('原始数据','端点线性度');title('a3');
y=b1;p=polyfit([t(1),t(58)],[y(1),y(58)],1);PP=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
rb1=100*max(abs(polyval(p,t)-y))/max(y);
subplot(234);plot(t,y,'-',ti,yi,'--');
legend('原始数据','端点线性度');title('b1');
y=b2;p=polyfit([t(1),t(58)],[y(1),y(58)],1);PP=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
rb2=100*max(abs(polyval(p,t)-y))/max(y);
subplot(235);plot(t,y,'-',ti,yi,'--');
legend('原始数据','端点线性度');title('b2');
y=b3;p=polyfit([t(1),t(58)],[y(1),y(58)],1);PP=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
rb3=100*max(abs(polyval(p,t)-y))/max(y);
subplot(236);plot(t,y,'-',ti,yi,'--');
legend('原始数据','端点线性度');title('b3');
fprintf('a1: %f%%	a2: %f%%	a3: %f%%;\n',ra1,ra2,ra3);
fprintf('b1: %f%%	b2: %f%%	b3: %f%%\n',rb1,rb2,rb3);
```

结果：
```
a1: 8.865147%	a2: 8.408538%	a3: 8.312564%;
b1: 7.649573%	b2: 14.516502%	b3: 15.169430%
```
![ddxxd](\ddxxd.png)

#### 2. 最小二乘线性度

```matlab
y=a1;p=polyfit(t,y,1);pp=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
ra1=100*max(abs(polyval(p,t)-y))/max(y);
subplot(231);plot(t,y,'-',ti,yi,'--');
legend('原始数据','最小二乘线性度');title('a1');
y=a2;p=polyfit(t,y,1);pp=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
ra2=100*max(abs(polyval(p,t)-y))/max(y);
subplot(232);plot(t,y,'-',ti,yi,'--');
legend('原始数据','最小二乘线性度');title('a2');
y=a3;p=polyfit(t,y,1);pp=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
ra3=100*max(abs(polyval(p,t)-y))/max(y);
subplot(233);plot(t,y,'-',ti,yi,'--');
legend('原始数据','最小二乘线性度');title('a3');
y=b1;p=polyfit(t,y,1);pp=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
rb1=100*max(abs(polyval(p,t)-y))/max(y);
subplot(234);plot(t,y,'-',ti,yi,'--');
legend('原始数据','最小二乘线性度');title('b1');
y=b2;p=polyfit(t,y,1);pp=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
rb2=100*max(abs(polyval(p,t)-y))/max(y);
subplot(235);plot(t,y,'-',ti,yi,'--');
legend('原始数据','最小二乘线性度');title('b2');
y=b3;p=polyfit(t,y,1);pp=poly2str(p,'t');
ti=linspace(3,60,50000);yi=polyval(p,ti);
rb3=100*max(abs(polyval(p,t)-y))/max(y);
subplot(236);plot(t,y,'-',ti,yi,'--');
legend('原始数据','最小二乘线性度');title('b3');
fprintf('a1: %f%%	a2: %f%%	a3: %f%%;\n',ra1,ra2,ra3);
fprintf('b1: %f%%	b2: %f%%	b3: %f%%\n',rb1,rb2,rb3);
```

结果：
```
a1: 9.070295%	a2: 5.926382%   a3: 7.982126%;
b1: 6.091355%	b2: 16.776519%	b3: 10.291194%
```
![zxecxxd](\zxecxxd.png)





#### 3.迟滞

```matlab
g1=50*max(abs(a1-b1))/max([a1,b1]);
g2=50*max(abs(a2-b3))/max([a2,b2]);
g3=50*max(abs(a3-b3))/max([a3,b3]);
fprintf('group1: %f%%   group2: %f%%    group3: %f%%\n',g1,g2,g3);
```

结果：
```
group1: 6.474359%   group2: 9.630607%    group3: 7.328767%
```

#### 4. 重复性

```matlab
u=max([abs(a1-a2),abs(a1-a3),abs(a3-a2)]);
d=max([abs(b1-b2),abs(b1-b3),abs(b3-b2)]);
result=50*max(u,d)/max([a1,a2,a3,b1,b2,b3]);
fprintf('%f%%\n',result);
```

结果：

```
9.358974%
```

#### 5. 误差

```matlab
p=mean(num);%均值，1行多列
I=num-[p;p;p;p;p;p];%残差
k=20;%预设级数
[m,n]=size(I);
y=double(I);
miny=min(y(:));
maxy=max(y(:));
inte=(maxy-miny)/k;
inter=miny+inte:inte:maxy;
g=zeros(1,k);
for i=1:m
    for j=1:n
        s=find(inter>=y(i,j));
        g(s(1))=g(s(1))+1;
    end
end
g=(g/(m*n))/inte;%频率密度
figure(3)
x=inter-inte;
bar(x,g,0.9);
axis tight;
hold on;
xlabel('误差');
ylabel('频率密度');
z=sort(reshape(I,1,m*n));%残差，转换为行向量，从小到大的排序
sig=std(z);%得到标差
f=exp(-z.^2/(2*sig^2))/(sig*sqrt(2*pi));%正态分布
plot(z,f,'-r');
legend('误差分布','正态分布');
```

结果：

![untitled](\untitled.png)

## 五、实验思考

#### 1、如何计算期望，标准差？
##### 答：

###### 期望：$$E =\frac{1}{N} \sum_{i=1}^N x_i$$

###### 标准差：$$\sigma = \sqrt{\frac{1}{N} \sum_{i=1}^N (x_i-E)^2}$$

#### 2、如何发现累进性系统误差和周期性系统误差？

##### 答：

###### 累进性系统误差——马利科夫准则
###### 周期性系统误差——阿卑-赫梅特准则 